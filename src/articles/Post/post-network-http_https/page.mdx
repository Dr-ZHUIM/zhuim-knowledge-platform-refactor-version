---
title: HTTP与HTTPS的区别
category: Network
sidecategory: 
abstract: 本文将讨论一个经典问题：请你说说 HTTP 与 HTTPS 的区别 😄
cover: 
layer: Post
createdat: 2024-02-21 20:21
---



本文将讨论一个经典问题：请你说说 HTTP 与 HTTPS 的区别 :smile:

## 知识前提

### HTTP

#### Part I. HTTP 是什么?

HTTP (The HyperText Transfer Protocol 超文本传输协议) 是一个设计于在连接的设备之间传输信息的基于 TCP/IP 的应用层协议 (网络协议层次的顶部)

简单描述一个 HTTP 协议的使用案例: 客户端向服务器发送请求，然后服务器根据请求头、请求体信息决定返回的信息。

HTTP 协议是万维网的基石，也被用于超文本连接以此读取 web 页面。

HTTP 协议具有无状态性。

##### Period I. HTTP/0.9 (1991)

作为 HTTP 协议的最初版，它可以说是非常简陋，具有以下特点：

1. 只有一个请求方法: GET

2. 没有支持头

3. 响应必须是 HTML

在 HTTP/0.9 时代，请求会是这个样子的:

```js
GET / index.html;
```

响应则是这个样子：

```js
(response body)
(connection closed)
```

简单来说就是，服务器接收到客户端的请求，返回 HTML 作为响应，一旦内容传输完毕，连接就会被关闭。

---

##### Period II. HTTP/1.0 (1996)

到了 HTTP/1.0 时代，HTTP 比起它的原始版本可以说是突飞猛进，它具有以下特点：

1. 增加了**请求类型**: POST,HEAD

2. 可以处理其他的**响应类型**，比如 Image,video,plain text 等

3. 响应对象以一个响应状态行开始

4. 请求与响应**支持头域**

5. **默认使用短连接模式**，即每一个请求建立一个 TCP 连接，请求完成后立马断开连接。这将会导致 2 个问题：连接无法复用，head of line blocking。连接无法复用会导致每次请求都经历三次握手和慢启动。三次握手在高延迟的场景下影响较明显，慢启动则对文件类请求影响较大。head of line blocking 会导致带宽无法被充分利用，以及后续健康请求被阻塞。

6. 想要使用长连接模式，需要在 Header 中添加 `Connection: Keep-Alive`

在 HTTP/1.0 时代，请求会是这个样子的:

```
GET / HTTP/1.0
Host: cs.fyi
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5)
Accept: */*
```

响应则是这个样子：

```
HTTP/1.0 200 OK
Content-Type: text/plain
Content-Length: 137582
Expires: Thu, 05 Dec 1997 16:00:00 GMT
Last-Modified: Wed, 5 August 1996 15:55:28 GMT
Server: Apache 0.84

(response body)
(connection closed)
```

---

##### Period III. HTTP/1.1 (1999)

HTTP 1.1 引入了许多关键性能优化：默认长连接，chunked 编码传输，字节范围请求，请求流水线等,它具有以下特点：

1. 添加了请求类型：OPTIONS,PUT, DELETE, TRACE, CONNECT

2. 请求消息和响应消息都支持 Host 头域: 在 HTTP1.0 中认为每台服务器都绑定一个唯一的 IP 地址，因此，请求消息中的 URL 并没有传递主机名（hostname）。但随着虚拟主机技术的发展，在一台物理服务器上可以存在多个虚拟主机（Multi-homed Web Servers），并且它们共享一个 IP 地址。因此，Host 头的引入就很有必要了。

3. **默认使用长连接模式**：默认情况下允许 HTTP 请求结束后将 TCP 连接保持

4. 想要使用短连接模式，需要在 Header 中添加 `Connection: close`

5. 缓存处理：HTTP/1.1 在 1.0 的基础上加入了一些 cache 的新特性，引入了实体标签，一般被称为 e-tags，新增更为强大的 `Cache-Control` 头。

6. chunked 编码传输：**分段传输数据**，并为数据标明长度

7. 字节范围请求：允许**只请求资源的某个部分**，用于在客户端已有一定数据的情况下，节省带宽。如果服务器相应地返回了对象所请求范围的内容，则响应码 206（Partial Content）。

8. Client Cookies: HTTP 作为**无状态协议**，无法记录稳定的状态信息，cookies 则是服务器发送到客户端浏览器本地的数据，在下一次请求发送时，cookies 会被连带发送至服务器。

---

##### Period IV. HTTP/2.0 (2015)

它具有以下特点：

1. 二进制协议：HTTP/2.0 将数据分割为更小的消息和帧，并将它们转为二进制编码。其中 meta 数据被转换为 HEADER 帧，传输的数据被转换为 DATA 帧。

2. 帧与流(**frame** and **stream**)：HTTP/2.0 的请求与响应都会建立一个单独的由帧组成的流, 每一个流都有自己的 ID，每一个帧首部都有流标识符，数据发送或获取后，会根据帧的流标识符将数据组装。

3. 多路复用：HTTP/2.0 通信都在一个连接完成，这个连接可以承载任意数量的双向数据流。

4. 头部压缩：用于处理重复对同一个服务器请求带来的过多额外头部信息。

5. 服务器端推流：允许服务器判断客户端需要哪些数据，额外推送过来进行缓存。

6. 优先权和依赖：每个流都有自己的优先级别，会表明哪个流是最重要的，客户端能指定哪个流是最重要的，这样一个流可以依赖另外一个流

7. 方便中断：使用 HTTP/2.0 的 RST_STREAM 将能方便停止一个信息传输，启动新的信息，而 HTTP/1.0 只能中断 TCP 连接, 显得太过昂贵

---

##### Period V. HTTP/3 (2017)

HTTP3 协议解决了这些问题：

1. HTTP3 基于 UDP 协议重新定义了连接，在 QUIC (Quick Udp Internet Connections) 层实现了无序、并发字节流的传输，解决了队头阻塞问题

2. HTTP3 重新定义了 TLS 协议加密 QUIC 头部的方式，既提高了网络攻击成本，又降低了建立连接的速度

3. HTTP3 将 Packet、QUIC Frame、HTTP3 Frame 分离，实现了连接迁移功能，降低了 5G 环境下高速移动设备的连接维护成本。

---

#### Part II. HTTP 请求 是什么?

HTTP 属于一种客户端-服务器(client-server)协议，HTTP 请求(request)是指客户端 -- 一般是浏览器 -- 发出的信息，与之相对应的由服务器返回的答复被称为 相应(response)

每个 HTTP 请求都携带着各种加密的数据

一个标准的 HTTP 请求含有以下内容:

1. HTTP 版本类型

2. URL

3. HTTP 方法

4. HTTP 请求头

5. (可选) HTTP 请求体

---

### HTTPS

#### Part I. HTTPS 是什么?

当一个 HTTP 连接使用了 SSL/TLS 协议，我们称它为 HTTPS，S 意为 **安全** (**secure**)

---

#### Part II. 为何需要 HTTPS?

这里一共有三大使用 HTTPS 的原因：

1. 隐私性 (Privacy)

2. 可靠性 (Integrity)

3. 可验证性 (Identification)

##### 隐私性

HTTPS 会通过浏览器告知用户连接是安全的，个人信息不会被窃取.

##### 可靠性

HTTPS 能够确保连接的信息没有被挟持.

##### 可验证性

HTTPS 能验证目标网站和用户的个人身份.

HTTPS 通过电子签名 (digital signature) 来验证用户

同时, HTTPS 通过 SSL 证书 (SSL certificate) 与 CA 证书 (Certificate Authority) 来验证服务器.

---

#### Part III. 密钥

HTTPS 需要一个能够保障隐私性、可靠性、可验证性的方案，那就是加密算法。

接下来，一起看看 HTTPS 使用了什么加密算法.

##### 对称加密法 🔑

在对称加密法中，只有一份密钥用来加密或者解密信息，发送方与接收方使用相同的密钥.

**请求步骤:** 发送方发送一条用密钥加密的信息

1. 发送方准备发送信息

2. 信息被加密算法加密数次

3. 发送方发送信息

**Receive Step** 接收方使用相同的密钥解密信息.

1. 接收方获取到加密信息

2. 使用相同的密钥解密数次

3.接收方获取到信息

**注意:**

- 不管是谁只要有这个密钥都能解读信息，所以要注意密钥的存放.

---

##### 非对称加密法 🔑🔑

非对称加密法提供两份密钥：公钥与个人密钥.

你可以把公钥给任何人，公钥用于加密信息

个人密钥用于解密信息

**注意:**

非对称加密法有助与保障隐私性，也因为只有拥有者有两把密钥能够解密信息，故非对称加密法也能够保障可验证性

---

#### Part IV. 握手

当浏览器与服务器通信时，它们会建立一个安全的TCP(基于 HTTP2.0)连接去传输信息 。

在此他们要进行三次握手的安全验证操作，如果验证失败，浏览器会有警告或者报错。

##### 客户端握手请求

首先，客户端发送握手请求，握手请求中包含客户端能够使用的 SSL/TLS 版本以及加密算法。

##### 服务器握手请求

第二步，服务端从客户端发来的版本列表中制作一份确认 SSL/TLS 版本以及加密算法的协商响应，同时服务端会返回它的证书与公钥

##### 客户端证书验证与密钥交换

第三步，客户端验证证书以确保证书的合法信息(有效日期,颁发机构)，同时将服务端的公钥通过对称加密法生成一个预主密钥(pre-master key)

客户端将预主密钥发送至服务端

##### 服务端解密预主密钥

服务器用私钥解密预主密钥，获取对称密钥

##### 使用对称密钥进行通信

双方使用对称密钥进行解码或者加码，能够快乐的通信了。

---

#### Part V. 证书授权

CA 证书(certificate authority)是一种第三方机构认证的证书，制作证书有三个步骤：

1. **发行证书**
2. **验证拥有者身份**
3. **提供证书有效的证明**

##### 如何验证 CA 证书?

当 CA 机构发布 CA 证书时, 他们会把 root 级证书标记在证书上，对于客户端来说，验证要分为几步

- 浏览器通过 HTTPS 连接站点时，下载证书
  - 证书是 root 级证书.
  - **验证成功**
- 证书不是 root 级证书.
- 浏览器下载站点曾经使用的证书.
  - 证书是 root 级证书.
  - **验证成功**
- 证书仍不是 root 级证书.
- 浏览器继续下载站点曾经使用的证书
  - 证书是 root 级证书.
  - **验证成功**
- 最后一份证书也不是 root 级证书
- 站点不被信任

---

## 结论

HTTP 与 HTTPS 的区别：

1. https 协议需要到 ca 申请证书或自制证书。
2. http 的信息是明文传输,https 则是具有安全性的 ssl 加密。
3. http 端口为 80,https 端口为 443。
4. http 的连接很简单,是无状态的;HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 http 协议安全。
